import logging

from django.test import TestCase

#from apps.api import helpers
from apps.info_bot.helpers import parse_trading_pair_string, counter_currency_name
from apps.info_bot.helpers import default_counter_currency_for, trading_pairs_for

from settings import USDT, BTC, COUNTER_CURRENCIES

# logging.getLogger("ccxt").setLevel(logging.INFO)
# logging.getLogger("urllib3").setLevel(logging.INFO)





class TestTelegramBotHelpers(TestCase):

    def setUp(self):
        self.binance_coins = [('KNC', 0), ('SALT', 1), ('ICN', 1), ('ADX', 0), ('GXS', 0), ('CHAT', 0), ('VIA', 1), ('YOYOW', 0), ('ARK', 0), ('HSR', 1), ('GRS', 0), ('NULS', 1), ('AE', 0), ('RDN', 1), ('BRD', 0), ('STORJ', 1), ('TNB', 0), ('VIBE', 1), ('GAS', 0), ('EVX', 1), ('DNT', 0), ('RLC', 1), ('TNT', 0), ('MDA', 1), ('ELF', 1), ('ICX', 1), ('IOTA', 1), ('GRS', 1), ('QSP', 1), ('AMB', 0), ('REQ', 1), ('BCPT', 0), ('BCH', 1), ('SALT', 0), ('XZC', 0), ('VEN', 0), ('EDO', 0), ('ZRX', 0), ('RCN', 0), ('MTH', 0), ('SNGLS', 1), ('TNB', 1), ('ICX', 0), ('LEND', 0), ('SNM', 0), ('OST', 1), ('BCD', 0), ('WINGS', 1), ('WAVES', 0), ('LTC', 1), ('ENJ', 1), ('BCPT', 1), ('GVT', 0), ('VEN', 1), ('XRB', 0), ('SYS', 1), ('MTL', 1), ('QLC', 1), ('CMT', 1), ('OAX', 1), ('BTG', 0), ('NAV', 0), ('BTG', 1), ('BNT', 0), ('INS', 1), ('AMB', 1), ('STORM', 1), ('XMR', 1), ('STRAT', 0), ('GVT', 1), ('XZC', 1), ('AE', 1), ('DLT', 1), ('AST', 1), ('WABI', 0), ('NEO', 1), ('VIBE', 0), ('GXS', 1), ('RLC', 0), ('TRX', 1), ('NCASH', 1), ('LRC', 1), ('BQX', 1), ('LINK', 1), ('NAV', 1), ('BNT', 1), ('INS', 0), ('STRAT', 1), ('PIVX', 0), ('VIB', 1), ('ELF', 0), ('BRD', 1), ('CND', 1), ('WINGS', 0), ('OAX', 0), ('ICN', 0), ('CND', 0), ('DASH', 1), ('FUN', 1), ('XEM', 0), ('CHAT', 1), ('DGD', 0), ('MANA', 1), ('PIVX', 1), ('ARN', 1), ('SNT', 1), ('CDT', 1), ('SNM', 1), ('MCO', 1), ('BAT', 1), ('BCD', 1), ('ONT', 1), ('WPR', 1), ('ETC', 0), ('FUN', 0), ('XRB', 1), ('BQX', 0), ('BTS', 0), ('SYS', 0), ('IOTA', 0), ('ARK', 1), ('POE', 1), ('LTC', 0), ('VIA', 0), ('SUB', 1), ('LSK', 0), ('ZIL', 1), ('XEM', 1), ('WAVES', 1), ('EVX', 0), ('MDA', 0), ('BLZ', 0), ('REQ', 0), ('TRX', 0), ('CMT', 0), ('DGD', 1), ('MTH', 1), ('ZIL', 0), ('RPX', 0), ('EOS', 0), ('LEND', 1), ('TNT', 1), ('ZRX', 1), ('ETH', 2), ('RDN', 0), ('STORJ', 0), ('BNB', 2), ('KNC', 1), ('ETC', 1), ('IOST', 0), ('NEBL', 1), ('OMG', 0), ('POA', 1), ('MOD', 1), ('KMD', 1), ('BCH', 2), ('LUN', 1), ('BTS', 1), ('OST', 0), ('DASH', 0), ('NEBL', 0), ('XMR', 0), ('OMG', 1), ('ENG', 1), ('QSP', 0), ('PPT', 1), ('LUN', 0), ('XLM', 1), ('FUEL', 0), ('STORM', 0), ('ADA', 2), ('QTUM', 1), ('APPC', 1), ('WABI', 1), ('BAT', 0), ('TRIG', 1), ('BNB', 1), ('ENJ', 0), ('LRC', 0), ('ADA', 1), ('MANA', 0), ('ADA', 0), ('HSR', 0), ('STEEM', 0), ('DLT', 0), ('GTO', 1), ('MTL', 0), ('APPC', 0), ('POWR', 0), ('AION', 0), ('XRP', 0), ('AION', 1), ('SUB', 0), ('AST', 0), ('STEEM', 1), ('NCASH', 0), ('WTC', 0), ('WAN', 0), ('YOYOW', 1), ('LSK', 1), ('WPR', 0), ('ARN', 0), ('LTC', 2), ('XLM', 0), ('BNB', 0), ('NEO', 2), ('EDO', 1), ('PPT', 0), ('ZEC', 1), ('KMD', 0), ('SNGLS', 0), ('DNT', 1), ('QTUM', 0), ('FUEL', 1), ('WTC', 1), ('IOST', 1), ('MOD', 0), ('POA', 0), ('RCN', 1), ('POWR', 1), ('RPX', 1), ('MCO', 0), ('XVG', 1), ('SNT', 0), ('POE', 0), ('BLZ', 1), ('BTC', 2), ('QTUM', 2), ('XRP', 1), ('ADX', 1), ('WAN', 1), ('VIB', 0), ('EOS', 1), ('TRIG', 0), ('NEO', 0), ('ETH', 0), ('ENG', 0), ('CDT', 0), ('ONT', 0), ('LINK', 0), ('ZEC', 0), ('QLC', 0), ('BCH', 0), ('XVG', 0), ('NULS', 0), ('GTO', 0), ('CLOAK', 0), ('CLOAK', 1)]
        self.trading_pairs_available = [('XVC', 'BTC'), ('2GIVE', 'BTC'), ('NXC', 'BTC'), ('XMY', 'BTC'), ('LMC', 'BTC'), ('DOPE', 'BTC'), ('SNRG', 'BTC'), ('SWIFT', 'BTC'), ('ABY', 'BTC'), ('TRUST', 'BTC'), ('SEQ', 'BTC'), ('XMG', 'BTC'), ('XST', 'BTC'), ('PINK', 'BTC'), ('RBY', 'BTC'), ('VTR', 'BTC'), ('PTC', 'BTC'), ('CRB', 'BTC'), ('TX', 'BTC'), ('LGD', 'BTC'), ('SYNX', 'BTC'), ('PAY', 'ETH'), ('ION', 'BTC'), ('DTB', 'BTC'), ('SPHR', 'BTC'), ('MUSIC', 'BTC'), ('IOC', 'BTC'), ('XDN', 'BTC'), ('GOLOS', 'BTC'), ('TUSD', 'ETH'), ('TUSD', 'USDT'), ('BNT', 'BTC'), ('LUN', 'BTC'), ('DNT', 'ETH'), ('BLITZ', 'BTC'), ('DYN', 'BTC'), ('COVAL', 'BTC'), ('ADT', 'BTC'), ('FLDC', 'BTC'), ('OMNI', 'BTC'), ('VEE', 'BTC'), ('IGNIS', 'BTC'), ('XEL', 'BTC'), ('TRST', 'BTC'), ('MEME', 'BTC'), ('TIX', 'BTC'), ('WINGS', 'ETH'), ('EMC', 'BTC'), ('ENRG', 'BTC'), ('GLD', 'BTC'), ('EMC2', 'BTC'), ('VRM', 'BTC'), ('CANN', 'BTC'), ('MER', 'BTC'), ('ETC', 'ETH'), ('PAY', 'BTC'), ('RLC', 'ETH'), ('CRW', 'BTC'), ('VRC', 'BTC'), ('GRC', 'BTC'), ('RCN', 'BTC'), ('QRL', 'BTC'), ('CLOAK', 'BTC'), ('FCT', 'ETH'), ('UP', 'ETH'), ('THC', 'BTC'), ('GNT', 'ETH'), ('DOGE', 'BTC'), ('EGC', 'BTC'), ('PPC', 'BTC'), ('SIB', 'BTC'), ('SPR', 'BTC'), ('BYC', 'BTC'), ('WAVES', 'ETH'), ('HMQ', 'BTC'), ('POLY', 'ETH'), ('LRC', 'ETH'), ('ADT', 'ETH'), ('INCNT', 'BTC'), ('DMD', 'BTC'), ('SALT', 'ETH'), ('UNB', 'BTC'), ('VIB', 'ETH'), ('MCO', 'ETH'), ('BNT', 'ETH'), ('TRX', 'BTC'), ('ENG', 'BTC'), ('NAV', 'BTC'), ('VIB', 'BTC'), ('MANA', 'BTC'), ('TIX', 'ETH'), ('SYS', 'BTC'), ('BCY', 'BTC'), ('MUE', 'BTC'), ('ZRX', 'BTC'), ('ANT', 'ETH'), ('PTOY', 'BTC'), ('EXP', 'BTC'), ('UKG', 'BTC'), ('FLO', 'BTC'), ('NLG', 'BTC'), ('PTOY', 'ETH'), ('XWC', 'BTC'), ('STEEM', 'BTC'), ('CLAM', 'BTC'), ('LBC', 'BTC'), ('XRP', 'USDT'), ('NEOS', 'BTC'), ('REP', 'ETH'), ('NBT', 'BTC'), ('POWR', 'ETH'), ('SC', 'ETH'), ('REP', 'BTC'), ('POLY', 'BTC'), ('BAY', 'BTC'), ('BRK', 'BTC'), ('CVC', 'ETH'), ('OMG', 'USDT'), ('BTG', 'BTC'), ('VIA', 'BTC'), ('VTC', 'BTC'), ('OMG', 'BTC'), ('KORE', 'BTC'), ('NMR', 'BTC'), ('ANT', 'BTC'), ('RCN', 'ETH'), ('DGB', 'BTC'), ('SLS', 'BTC'), ('PIVX', 'BTC'), ('LUN', 'ETH'), ('EFL', 'BTC'), ('POT', 'BTC'), ('TUSD', 'BTC'), ('WAVES', 'BTC'), ('BCPT', 'BTC'), ('ZEC', 'USDT'), ('RVR', 'BTC'), ('DMT', 'BTC'), ('UKG', 'ETH'), ('AMP', 'BTC'), ('DCT', 'BTC'), ('GAME', 'BTC'), ('CURE', 'BTC'), ('SWT', 'BTC'), ('BLOCK', 'BTC'), ('QWARK', 'BTC'), ('XCP', 'BTC'), ('XVG', 'USDT'), ('DCR', 'BTC'), ('GRS', 'BTC'), ('XEM', 'ETH'), ('BTC', 'USDT'), ('WINGS', 'BTC'), ('BURST', 'BTC'), ('UP', 'BTC'), ('GUP', 'ETH'), ('SALT', 'BTC'), ('MONA', 'BTC'), ('XEM', 'BTC'), ('EDG', 'BTC'), ('NXS', 'BTC'), ('DNT', 'BTC'), ('DMT', 'ETH'), ('GNO', 'BTC'), ('GUP', 'BTC'), ('FTC', 'BTC'), ('LRC', 'BTC'), ('UBQ', 'BTC'), ('BRX', 'BTC'), ('ENG', 'ETH'), ('GEO', 'BTC'), ('WAX', 'BTC'), ('AUR', 'BTC'), ('BCH', 'USDT'), ('BITB', 'BTC'), ('ETH', 'BTC'), ('LTC', 'BTC'), ('LTC', 'ETH'), ('SNT', 'ETH'), ('BCH', 'ETH'), ('CFI', 'BTC'), ('EBST', 'BTC'), ('EXCL', 'BTC'), ('SBD', 'BTC'), ('XLM', 'BTC'), ('ZEC', 'ETH'), ('LTC', 'USDT'), ('SHIFT', 'BTC'), ('BTG', 'ETH'), ('GBYTE', 'BTC'), ('QTUM', 'ETH'), ('ETC', 'USDT'), ('NXT', 'BTC'), ('XMR', 'USDT'), ('MANA', 'ETH'), ('MLN', 'BTC'), ('ADX', 'ETH'), ('SRN', 'BTC'), ('BCH', 'BTC'), ('ETC', 'BTC'), ('FCT', 'BTC'), ('NEO', 'BTC'), ('ZRX', 'ETH'), ('BTG', 'USDT'), ('GBG', 'BTC'), ('NXT', 'USDT'), ('PART', 'BTC'), ('ZEC', 'BTC'), ('DASH', 'ETH'), ('ADA', 'ETH'), ('MCO', 'BTC'), ('AEON', 'BTC'), ('ARDR', 'BTC'), ('BLK', 'BTC'), ('TKS', 'BTC'), ('XMR', 'ETH'), ('ZCL', 'BTC'), ('ARK', 'BTC'), ('OK', 'BTC'), ('XRP', 'BTC'), ('BAT', 'ETH'), ('CVC', 'BTC'), ('DASH', 'BTC'), ('NEO', 'USDT'), ('RLC', 'BTC'), ('SC', 'BTC'), ('STORJ', 'BTC'), ('ADX', 'BTC'), ('DGB', 'ETH'), ('LSK', 'BTC'), ('OMG', 'ETH'), ('POWR', 'BTC'), ('RDD', 'BTC'), ('STRAT', 'BTC'), ('XVG', 'BTC'), ('ETH', 'USDT'), ('KMD', 'BTC'), ('ADA', 'BTC'), ('BAT', 'BTC'), ('SNT', 'BTC'), ('ZEN', 'BTC'), ('NEO', 'ETH'), ('SRN', 'ETH'), ('STRAT', 'ETH'), ('TRX', 'ETH'), ('ADA', 'USDT'), ('BSD', 'BTC'), ('DASH', 'USDT'), ('GNO', 'ETH'), ('GNT', 'BTC'), ('IOP', 'BTC'), ('QTUM', 'BTC'), ('RADS', 'BTC'), ('WAX', 'ETH'), ('XLM', 'ETH'), ('XMR', 'BTC'), ('XRP', 'ETH'), ('XZC', 'BTC'), ('SLR', 'BTC'), ('BCN', 'BTC'), ('BELA', 'BTC'), ('BTS', 'BTC'), ('HUC', 'BTC'), ('MAID', 'BTC'), ('NMC', 'BTC'), ('RIC', 'BTC'), ('XBC', 'BTC'), ('XLM', 'USDT'), ('XPM', 'BTC'), ('LSK', 'ETH'), ('PASC', 'BTC'), ('REP', 'USDT'), ('GAS', 'BTC'), ('GAS', 'ETH'), ('KNC', 'BTC'), ('ICN', 'ETH'), ('GXS', 'BTC'), ('CHAT', 'BTC'), ('VIA', 'ETH'), ('YOYOW', 'BTC'), ('HSR', 'ETH'), ('NULS', 'ETH'), ('AE', 'BTC'), ('RDN', 'ETH'), ('BRD', 'BTC'), ('STORJ', 'ETH'), ('TNB', 'BTC'), ('VIBE', 'ETH'), ('EVX', 'ETH'), ('TNT', 'BTC'), ('MDA', 'ETH'), ('ELF', 'ETH'), ('ICX', 'ETH'), ('IOTA', 'ETH'), ('GRS', 'ETH'), ('QSP', 'ETH'), ('AMB', 'BTC'), ('REQ', 'ETH'), ('VEN', 'BTC'), ('EDO', 'BTC'), ('MTH', 'BTC'), ('SNGLS', 'ETH'), ('TNB', 'ETH'), ('ICX', 'BTC'), ('LEND', 'BTC'), ('SNM', 'BTC'), ('OST', 'ETH'), ('BCD', 'BTC'), ('ENJ', 'ETH'), ('BCPT', 'ETH'), ('GVT', 'BTC'), ('VEN', 'ETH'), ('XRB', 'BTC'), ('SYS', 'ETH'), ('MTL', 'ETH'), ('QLC', 'ETH'), ('CMT', 'ETH'), ('OAX', 'ETH'), ('INS', 'ETH'), ('AMB', 'ETH'), ('STORM', 'ETH'), ('GVT', 'ETH'), ('XZC', 'ETH'), ('AE', 'ETH'), ('DLT', 'ETH'), ('AST', 'ETH'), ('WABI', 'BTC'), ('VIBE', 'BTC'), ('GXS', 'ETH'), ('NCASH', 'ETH'), ('BQX', 'ETH'), ('LINK', 'ETH'), ('NAV', 'ETH'), ('INS', 'BTC'), ('ELF', 'BTC'), ('BRD', 'ETH'), ('CND', 'ETH'), ('OAX', 'BTC'), ('ICN', 'BTC'), ('CND', 'BTC'), ('FUN', 'ETH'), ('CHAT', 'ETH'), ('DGD', 'BTC'), ('PIVX', 'ETH'), ('ARN', 'ETH'), ('CDT', 'ETH'), ('SNM', 'ETH'), ('BCD', 'ETH'), ('ONT', 'ETH'), ('WPR', 'ETH'), ('FUN', 'BTC'), ('XRB', 'ETH'), ('BQX', 'BTC'), ('IOTA', 'BTC'), ('ARK', 'ETH'), ('POE', 'ETH'), ('SUB', 'ETH'), ('ZIL', 'ETH'), ('EVX', 'BTC'), ('MDA', 'BTC'), ('BLZ', 'BTC'), ('REQ', 'BTC'), ('CMT', 'BTC'), ('DGD', 'ETH'), ('MTH', 'ETH'), ('ZIL', 'BTC'), ('RPX', 'BTC'), ('EOS', 'BTC'), ('LEND', 'ETH'), ('TNT', 'ETH'), ('RDN', 'BTC'), ('BNB', 'USDT'), ('KNC', 'ETH'), ('IOST', 'BTC'), ('NEBL', 'ETH'), ('POA', 'ETH'), ('MOD', 'ETH'), ('KMD', 'ETH'), ('BTS', 'ETH'), ('OST', 'BTC'), ('NEBL', 'BTC'), ('QSP', 'BTC'), ('PPT', 'ETH'), ('FUEL', 'BTC'), ('STORM', 'BTC'), ('APPC', 'ETH'), ('WABI', 'ETH'), ('TRIG', 'ETH'), ('BNB', 'ETH'), ('ENJ', 'BTC'), ('HSR', 'BTC'), ('DLT', 'BTC'), ('GTO', 'ETH'), ('MTL', 'BTC'), ('APPC', 'BTC'), ('AION', 'BTC'), ('AION', 'ETH'), ('SUB', 'BTC'), ('AST', 'BTC'), ('STEEM', 'ETH'), ('NCASH', 'BTC'), ('WTC', 'BTC'), ('WAN', 'BTC'), ('YOYOW', 'ETH'), ('WPR', 'BTC'), ('ARN', 'BTC'), ('BNB', 'BTC'), ('EDO', 'ETH'), ('PPT', 'BTC'), ('SNGLS', 'BTC'), ('FUEL', 'ETH'), ('WTC', 'ETH'), ('IOST', 'ETH'), ('MOD', 'BTC'), ('POA', 'BTC'), ('RPX', 'ETH'), ('XVG', 'ETH'), ('POE', 'BTC'), ('BLZ', 'ETH'), ('QTUM', 'USDT'), ('WAN', 'ETH'), ('EOS', 'ETH'), ('TRIG', 'BTC'), ('CDT', 'BTC'), ('ONT', 'BTC'), ('LINK', 'BTC'), ('QLC', 'BTC'), ('NULS', 'BTC'), ('GTO', 'BTC'), ('TRST', 'ETH'), ('LGD', 'ETH'), ('ERC', 'BTC'), ('GAM', 'BTC'), ('QRL', 'ETH'), ('HMQ', 'ETH'), ('VEE', 'ETH'), ('CFI', 'ETH'), ('CLOAK', 'ETH'), ('BTCD', 'BTC'), ('NMR', 'ETH'), ('CRB', 'ETH'), ('PRO', 'BTC'), ('PRO', 'ETH'), ('SC', 'USDT'), ('TRX', 'USDT'), ('LOOM', 'ETH'), ('LOOM', 'BTC'), ('TSTETH', 'ETH')]

    def test_cmd_trading_pair_parse(self):
        # BTC -> BTC, USDT
        # others: OMG -> OMG, BTC
        # ETH_USDT -> ETH, USDT
        bad_format = {'counter_currency': None, 'transaction_currency': None}
        for coin in ("OMG", "ETH_BTC", "BTC/USDT", "XRP ETH"):
            self.assertNotEqual(parse_trading_pair_string(coin), bad_format)

        self.assertEqual(parse_trading_pair_string("__OMG_"), bad_format)
        self.assertEqual(parse_trading_pair_string("ASTALAVISTBABY"), bad_format)

    def test_counter_currency_name(self):
        self.assertEqual(counter_currency_name(0), 'BTC')
        self.assertEqual(counter_currency_name(2), 'USDT')
        self.assertEqual(counter_currency_name(3), 'XMR')

    def test_default_counter_currency_for(self):
        self.assertEqual('USDT', default_counter_currency_for('BTC', self.trading_pairs_available))
        self.assertEqual('USDT', default_counter_currency_for('ETH', self.trading_pairs_available))
        self.assertEqual('USDT', default_counter_currency_for('OMG', self.trading_pairs_available))
        self.assertEqual('BTC', default_counter_currency_for('FUEL', self.trading_pairs_available))
        self.assertEqual('ETH', default_counter_currency_for('TSTETH', self.trading_pairs_available))

    def test_trading_pairs_for(self):
        self.assertEqual([('ETH', 'BTC'), ('ETH', 'USDT')], trading_pairs_for('ETH', self.trading_pairs_available))
        self.assertEqual([('BTC', 'USDT')], trading_pairs_for('BTC', self.trading_pairs_available))
        self.assertEqual([('OMG', 'USDT'), ('OMG', 'BTC'), ('OMG', 'ETH')], trading_pairs_for('OMG', self.trading_pairs_available))
